<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>로그인</title>
  </head>
  <body align="center">
    <button id="login">Login</button>
    <p></p>
    <div
      style="height: 200px; width: 300px; background-color: aqua; margin: auto"
      id="modal"
      hidden
    >
      <p></p>
      듣는중입니다. 말해주세요.
      <p></p>
      <img src="mic.png" alt="마이크아이콘" style="height: 50%" />
      <p></p>
      <button id="complete">완료</button>
    </div>
  </body>
  <script>
    login = document.getElementById("login");
    modal = document.getElementById("modal");
    complete = document.getElementById("complete");

    if (navigator.mediaDevices) {
      const constraints = {
        audio: true,
      };
      navigator.mediaDevices
        .getUserMedia(constraints)
        .then((stream) => {
          const mediaRecorder = new MediaRecorder(stream);
          chunks = [];
          mediaRecorder.onstop = (e) => {
            console.log("이벤트 발생");
            console.log(URL.createObjectURL(new Blob(chunks)));
            login.href = URL.createObjectURL(new Blob(chunks)); // 여기 안돼용~~ 다운로드 부분임
            login.download = "test.wav";
          };

          login.addEventListener("click", () => {
            modal.hidden = false;
            mediaRecorder.start();
            console.log("녹음 시작");
          });

          complete.addEventListener("click", () => {
            modal.hidden = true;
            mediaRecorder.stop();
            console.log("녹음 끝");
          });
        })
        .catch((err) => {
          console.log("The following error occurred" + err);
        });
    }
  </script>
</html>
